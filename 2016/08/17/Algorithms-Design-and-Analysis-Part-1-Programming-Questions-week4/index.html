<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Algo Part 1 -- Programming Questions (week4) | 2017 07 01</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这里主要记录下来在 “Algo: Part 1” 的Programming Questions 中的算法、实现和作业中的困难。我是用的是 Python
问题：The file contains the edges of a directed graph. Vertices are labeled as positive integers from 1 to 875714. Every row in">
<meta property="og:type" content="article">
<meta property="og:title" content="Algo Part 1 -- Programming Questions (week4)">
<meta property="og:url" content="http://yoursite.com/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week4/index.html">
<meta property="og:site_name" content="2017 07 01">
<meta property="og:description" content="这里主要记录下来在 “Algo: Part 1” 的Programming Questions 中的算法、实现和作业中的困难。我是用的是 Python
问题：The file contains the edges of a directed graph. Vertices are labeled as positive integers from 1 to 875714. Every row in">
<meta property="og:updated_time" content="2016-08-20T16:57:37.620Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Algo Part 1 -- Programming Questions (week4)">
<meta name="twitter:description" content="这里主要记录下来在 “Algo: Part 1” 的Programming Questions 中的算法、实现和作业中的困难。我是用的是 Python
问题：The file contains the edges of a directed graph. Vertices are labeled as positive integers from 1 to 875714. Every row in">
  
    <link rel="alternate" href="/atom.xml" title="2017 07 01" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">2017 07 01</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">This is a battle!</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week4/" class="article-date">
  <time datetime="2016-08-17T15:24:10.000Z" itemprop="datePublished">2016-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Algo Part 1 -- Programming Questions (week4)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这里主要记录下来在 “Algo: Part 1” 的Programming Questions 中的算法、实现和作业中的困难。我是用的是 Python</p>
<h3 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h3><p>The file contains the edges of a directed graph. Vertices are labeled as positive integers from 1 to 875714. Every row indicates an edge, the vertex label in first column is the tail and the vertex label in second column is the head (recall the graph is directed, and the edges are directed from the first column vertex to the second column vertex). So for example, the 11th row looks liks : “2 47646”. This just means that the vertex with label 2 has an outgoing edge to the vertex with label 47646</p>
<p>Your task is to code up the algorithm from the video lectures for computing strongly connected components (SCCs), and to run this algorithm on the given graph.</p>
<p>Output Format: You should output the sizes of the 5 largest SCCs in the given graph, in decreasing order of sizes, separated by commas (avoid any spaces). So if your algorithm computes the sizes of the five largest SCCs to be 500, 400, 300, 200 and 100, then your answer should be “500,400,300,200,100” (without the quotes). If your algorithm finds less than 5 SCCs, then write 0 for the remaining terms. Thus, if your algorithm computes only 3 SCCs whose sizes are 400, 300, and 100, then your answer should be “400,300,100,0,0” (without the quotes). (Note also that your answer should not have any spaces in it.)</p>
<p>WARNING: This is the most challenging programming assignment of the course. Because of the size of the graph you may have to manage memory carefully. The best way to do this depends on your programming language and environment, and we strongly suggest that you exchange tips for doing this on the discussion forums.</p>
<h3 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h3><p>第四周，作业要求找出 “Strongly Connected Components” (SCC) 并计算其内部所含点的数量。如果一幅图上的任意一点都可以经由边与其他所有点相连，这个图就被称为 SCC，可以直观的理解为内部的点形成了回路的图。对于定向图，寻找 SCC 的方法基本可以分为以下几个步骤：</p>
<ul>
<li>生成定向图的反向图</li>
<li>对生成的反向图中的点进行深度优先搜索，纪录搜索结束的时间，最先搜索完成的点（也就是最底层的点）排到     最后，其次搜索完成的点（次底层点）排至倒数第二，依次类推；</li>
<li>对原定向图进行深度优先搜索，点的搜索顺序按照刚刚得到的完成顺序进行，纪录每一个点的上层点 (leader)；</li>
<li>根据每个点的上层点 (leader)，倒推得到 SCC。</li>
</ul>
<p>作业的难点在于深度优先算法在 python 中的实现。由于作业给的图非常大，如果在 python 中使用迭代的方式循环调用同一个函数来实现深度优先搜索，很有可能会导致达到迭代次数上限，所以只能用普通的循环语句来实现。<br>理论上，任何一个递归函数均可以转化成普通循环语句。<br>关于BFS与DFS从递归转普通循环，请参见<a href="http://stackoverflow.com/questions/5278580/non-recursive-depth-first-search-algorithm" target="_blank" rel="external">下面</a>的伪代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">DFS:</div><div class="line"></div><div class="line">list nodes_to_visit = &#123;root&#125;;</div><div class="line">while( nodes_to_visit isn&apos;t empty ) &#123;</div><div class="line">  currentnode = nodes_to_visit.first();</div><div class="line">  nodes_to_visit.prepend( currentnode.children );</div><div class="line">  //do something</div><div class="line">&#125;</div><div class="line"></div><div class="line">BFS:</div><div class="line"></div><div class="line">list nodes_to_visit = &#123;root&#125;;</div><div class="line">while( nodes_to_visit isn&apos;t empty ) &#123;</div><div class="line">  currentnode = nodes_to_visit.first();</div><div class="line">  nodes_to_visit.append( currentnode.children );</div><div class="line">  //do something</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码：<br>Python 代码如下。由于给的图非常大，所以我将整个进度打印在屏幕上，方便监视。本文参考了<a href="http://pikipity.github.io/blog/cousera-algorithm-week4.html" target="_blank" rel="external">这里</a>的代码并对其进行了改进，没有使用dict而是使用了nested list代表图形， 速度经测试提高了大约10倍。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">readin_graph</span><span class="params">(path)</span>:</span></div><div class="line">    <span class="string">""" Read the original file.</span></div><div class="line">    Args:</div><div class="line">    - path(string): The file path.</div><div class="line">    </div><div class="line">    returns:</div><div class="line">    - graph (nested list): with element index as the tail node, the list element</div><div class="line">        the head nodes that connected to the tail</div><div class="line">    </div><div class="line">    - node_list (list): A none repe </div><div class="line">    """</div><div class="line">    graph = [[]]</div><div class="line">    node_list = []</div><div class="line">    seen = set()</div><div class="line">    idx=<span class="number">0</span></div><div class="line">    <span class="keyword">with</span> open(path) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</div><div class="line">            temp = line.split(<span class="string">' '</span>)[:<span class="number">-1</span>]</div><div class="line">            tail, head = int(temp[<span class="number">0</span>]) - <span class="number">1</span>, int(temp[<span class="number">1</span>]) <span class="number">-1</span> </div><div class="line">            <span class="keyword">if</span> tail==idx:</div><div class="line">                graph[tail].append(head)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">while</span>(tail!=idx):</div><div class="line">                    graph.append([])</div><div class="line">                    idx+=<span class="number">1</span></div><div class="line">                graph[tail].append(head)</div><div class="line">    <span class="keyword">return</span> graph</div><div class="line"><span class="comment">#############    reverse graph         ################################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(graph)</span>:</span></div><div class="line">    <span class="string">"""Return a reversed graph.</span></div><div class="line">    Args:</div><div class="line">    - graph(list): list that represent the graph </div><div class="line">    </div><div class="line">    """</div><div class="line">    rev_graph = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(graph)):</div><div class="line">        rev_graph.append([])</div><div class="line">    <span class="keyword">for</span> idx, i <span class="keyword">in</span> enumerate(graph):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</div><div class="line">            rev_graph[j].append(idx)</div><div class="line">    <span class="keyword">return</span> rev_graph</div><div class="line"></div><div class="line"><span class="comment">############           DFS_search            ################################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">DFS_search</span><span class="params">(graph, nodes_to_visit, reverse, verbose)</span>:</span></div><div class="line">    <span class="string">"""DFS_search implementation.</span></div><div class="line">    The recusive DFS aglo was transfered here into a while loop to avoid </div><div class="line">    stack overflow. </div><div class="line">    To make the non recursive DFS algorithm, see reference:</div><div class="line">    http://stackoverflow.com/questions/5278580/non-recursive-depth-first-search-algorithm </div><div class="line">    </div><div class="line">    Args:</div><div class="line">    - graph (list): The graph for DFS</div><div class="line">    - nodes_to_visit (list): The DFS will be executed based on the given ordered </div><div class="line">        nodes list.</div><div class="line">    - reverse (bool): The graph is reversed or not. Depends on the value, </div><div class="line">        different object will be returned. If the graph is reversed </div><div class="line">        (1st DFS search), thenthe magic nodes list for the 2nd DFS search will </div><div class="line">        be returned. If the graph is not reversed (2nd DFS search on the </div><div class="line">        original graph), then the SCC dict with leader nodes will be returned. </div><div class="line">    - verbose (bool): Type some debug message if True.</div><div class="line">    </div><div class="line">    """</div><div class="line">    visited = set() <span class="comment">#Store the visited node here</span></div><div class="line">    <span class="keyword">if</span> reverse:</div><div class="line">        dfs_finish_order = [] <span class="comment">#Store the finished DFS node here in order. </span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        leader_with_scc = &#123;&#125; <span class="comment">#Store the scc with its leader node as key, scc as </span></div><div class="line">                             <span class="comment">#value (list)</span></div><div class="line">    N=<span class="number">1.0</span></div><div class="line">    N_total = len(nodes_to_visit)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nodes_to_visit:</div><div class="line">        N+=<span class="number">1</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"Finished %"</span>, N/N_total*<span class="number">100</span> <span class="comment">#Show progress</span></div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"start explore "</span>, i</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> visited:</div><div class="line">            <span class="keyword">if</span> verbose:</div><div class="line">                <span class="keyword">print</span> <span class="string">"Already explored "</span>, i</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> reverse:</div><div class="line">                leader_with_scc[i] = []</div><div class="line">            visited.add(i)</div><div class="line">            track = [i]     </div><div class="line">            <span class="keyword">while</span> len(track) != <span class="number">0</span>:</div><div class="line">                current_node = track[<span class="number">-1</span>]</div><div class="line">                <span class="keyword">if</span> verbose:</div><div class="line">                    <span class="keyword">print</span> <span class="string">'currently_on_node'</span>, current_node</div><div class="line">                visited.add(current_node)</div><div class="line">                </div><div class="line">                toextend = list(set(graph[current_node]) - visited)</div><div class="line">                <span class="keyword">if</span> len(toextend) == <span class="number">0</span>:</div><div class="line">                    finished_node = track.pop()</div><div class="line">                    <span class="keyword">if</span> reverse:</div><div class="line">                        dfs_finish_order.append(finished_node)</div><div class="line">                        <span class="keyword">if</span> verbose:</div><div class="line">                            <span class="keyword">print</span> <span class="string">"List of node finished search:"</span>, dfs_finish_order</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        leader_with_scc[i].append(finished_node)</div><div class="line">                <span class="keyword">else</span>: </div><div class="line">                    track.extend(toextend)</div><div class="line">    <span class="keyword">if</span> reverse:</div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"dfs_finish_time_list:"</span>, dfs_finish_order </div><div class="line">        <span class="keyword">return</span> dfs_finish_order</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"leader_with_scc:"</span>, leader_with_scc </div><div class="line">        <span class="keyword">return</span> leader_with_scc</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">reversed_magic_lise</span><span class="params">(magic_list)</span>:</span></div><div class="line">    <span class="string">"""return a reversed magic_list</span></div><div class="line">    firstly remove the duplicated element in order, then reverse the list.</div><div class="line">    eg: magic_list: [0,1,3,5,1,5,2]</div><div class="line">        cleaned magic_list: [0,1,3,5,2]</div><div class="line">        reversed magic_list: [2,5,3,1,0]</div><div class="line">    </div><div class="line">    Args:</div><div class="line">    - magic_list (list): a magic list</div><div class="line">    """</div><div class="line">    seen = set()</div><div class="line">    temp = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> magic_list:</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> seen:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            temp.append(i)</div><div class="line">            seen.add(i)</div><div class="line">    <span class="keyword">return</span> list( reversed(temp) )</div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">scc_size</span><span class="params">(scc_dict)</span>:</span></div><div class="line">    <span class="string">"""Print the first 5 largest scc size </span></div><div class="line">    Args:</div><div class="line">    - scc_dict (dict): key: leader node, value: scc nodes under the leader node.</div><div class="line">    """</div><div class="line">    </div><div class="line">    len_dict = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> scc_dict.keys():</div><div class="line">        len_dict[k] = len( set(scc_dict[k]) )</div><div class="line">    scc_len_list = list(sorted(len_dict.values(), reverse=<span class="keyword">True</span>))</div><div class="line">    <span class="keyword">print</span> <span class="string">"The first 5 largest SCC length : "</span>, scc_len_list[:<span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    start_time = time.time()</div><div class="line">    file = <span class="string">"_410e934e6553ac56409b2cb7096a44aa_SCC.txt"</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"..........................................read in graph... "</span></div><div class="line">    origin_graph = readin_graph(file)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"...........................................Reverse graph... "</span></div><div class="line">    reversed_graph = reverse(origin_graph)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"..................1st DFS search and generate magic list... "</span></div><div class="line">    magic_list = DFS_search(graph=reversed_graph, </div><div class="line">                            nodes_to_visit=range(<span class="number">875714</span>), </div><div class="line">                            reverse = <span class="keyword">True</span>, verbose=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">".......................................reverse magic_list... "</span></div><div class="line">    reversed_magic_list = reversed_magic_lise(magic_list) </div><div class="line">    </div><div class="line">    <span class="keyword">print</span> <span class="string">".............................2nd DFS search and generage SCC.."</span></div><div class="line">    scc = DFS_search(graph=origin_graph, </div><div class="line">                            nodes_to_visit=reversed_magic_list, </div><div class="line">                            reverse = <span class="keyword">False</span>, verbose=<span class="keyword">False</span>)</div><div class="line">    scc_size(scc)</div><div class="line">    <span class="keyword">print</span> <span class="string">"..................Time used in sec: "</span>, time.time() - start_time</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">if</span> <span class="keyword">False</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'graph:'</span>,origin_graph</div><div class="line">        <span class="keyword">print</span> <span class="string">"regraph:"</span>, reversed_graph</div><div class="line">        <span class="keyword">print</span> <span class="string">"magic_list"</span>, magic_list     </div><div class="line">        <span class="keyword">print</span> <span class="string">"reversed_magic_list: "</span>, magic_list</div><div class="line">        <span class="keyword">print</span> <span class="string">"SCC:"</span>, scc</div></pre></td></tr></table></figure>
<p>为了对比，这里也给出了递归形式的代码，递归形式的代码在小的图形中可以跑，在本题的图形中会出现stack overflow 的error. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.setrecursionlimit(<span class="number">20000</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">readin_graph</span><span class="params">(path)</span>:</span></div><div class="line">    <span class="string">""" Read the original file.</span></div><div class="line">    Args:</div><div class="line">    - path(string): The file path.</div><div class="line">    </div><div class="line">    returns:</div><div class="line">    - graph (nested list): with element index as the tail node, the list element</div><div class="line">        the head nodes that connected to the tail</div><div class="line">    </div><div class="line">    - node_list (list): A none repe </div><div class="line">    """</div><div class="line">    graph = [[]]</div><div class="line">    node_list = []</div><div class="line">    seen = set()</div><div class="line">    idx=<span class="number">0</span></div><div class="line">    <span class="keyword">with</span> open(path) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</div><div class="line">            temp = line.split(<span class="string">' '</span>)[:<span class="number">-1</span>]</div><div class="line">            tail, head = int(temp[<span class="number">0</span>]) - <span class="number">1</span>, int(temp[<span class="number">1</span>]) - <span class="number">1</span> </div><div class="line">            <span class="keyword">if</span> tail==idx:</div><div class="line">                graph[tail].append(head)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">while</span>(tail!=idx):</div><div class="line">                    graph.append([])</div><div class="line">                    idx+=<span class="number">1</span></div><div class="line">                graph[tail].append(head)</div><div class="line">    <span class="keyword">return</span> graph</div><div class="line"></div><div class="line"><span class="comment">#############    reverse graph         ################################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(graph)</span>:</span></div><div class="line">    <span class="string">"""Return a reversed graph.</span></div><div class="line">    Args:</div><div class="line">    - graph(list): list that represent the graph </div><div class="line">    </div><div class="line">    """</div><div class="line">    rev_graph = []</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(graph)):</div><div class="line">        rev_graph.append([])</div><div class="line">    <span class="keyword">for</span> idx, i <span class="keyword">in</span> enumerate(graph):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i:</div><div class="line">            rev_graph[j].append(idx)</div><div class="line">    <span class="keyword">return</span> rev_graph</div><div class="line"></div><div class="line"><span class="comment">############           DFS            ################################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">DFS</span><span class="params">(graph, nodes_to_visit, reverse, verbose)</span>:</span></div><div class="line">    <span class="string">'''Recusive DFS_search implementation.</span></div><div class="line">    Args:</div><div class="line">    - graph (list): The graph for DFS</div><div class="line">    - nodes_to_visit (list): The DFS will be executed based on the given ordered </div><div class="line">        nodes list.</div><div class="line">    - reverse (bool): The graph is reversed or not. Depends on the value, </div><div class="line">        different object will be returned. If the graph is reversed </div><div class="line">        (1st DFS search), thenthe magic nodes list for the 2nd DFS search will </div><div class="line">        be returned. If the graph is not reversed (2nd DFS search on the </div><div class="line">        original graph), then the SCC dict with leader nodes will be returned. </div><div class="line">    - verbose (bool): Type some debug message if True.</div><div class="line">    </div><div class="line">    '''</div><div class="line">    visited = set()</div><div class="line">    leader_with_scc = &#123;&#125;</div><div class="line">    dfs_finish_order = []</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(graph, leader_with_scc, leader, i, visited, verbose)</span>:</span></div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"On node: "</span>,i</div><div class="line">        visited.add(i)</div><div class="line">        leader_with_scc[leader].append(i)</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> graph[i]:</div><div class="line">            <span class="keyword">if</span> j <span class="keyword">in</span> visited:</div><div class="line">                <span class="keyword">if</span> verbose:</div><div class="line">                    <span class="keyword">print</span> <span class="string">"Already visited "</span>, j</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                dfs(graph, leader_with_scc, leader, j, visited, verbose)</div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"complete "</span>, i</div><div class="line">        dfs_finish_order.append(i)</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> nodes_to_visit:</div><div class="line">        <span class="keyword">if</span> verbose:</div><div class="line">            <span class="keyword">print</span> <span class="string">"Start exploring "</span>, n </div><div class="line">        <span class="keyword">if</span> n <span class="keyword">in</span> visited:</div><div class="line">            <span class="keyword">if</span> verbose:</div><div class="line">                <span class="keyword">print</span> <span class="string">"Already explored "</span>,n</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            leader_with_scc[n] = []</div><div class="line">            dfs(graph, leader_with_scc, n, n, visited, verbose)</div><div class="line">    <span class="keyword">if</span> reverse:</div><div class="line">        <span class="keyword">return</span> dfs_finish_order</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> leader_with_scc</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">scc_size</span><span class="params">(scc_dict)</span>:</span></div><div class="line">    <span class="string">"""Print the first 5 largest scc size </span></div><div class="line">    Args:</div><div class="line">    - scc_dict (dict): key: leader node, value: scc nodes under the leader node.</div><div class="line">    """</div><div class="line">    </div><div class="line">    len_dict = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> scc_dict.keys():</div><div class="line">        len_dict[k] = len( set(scc_dict[k]) )</div><div class="line">    scc_len_list = list(sorted(len_dict.values(), reverse=<span class="keyword">True</span>))</div><div class="line">    <span class="keyword">print</span> <span class="string">"The first 5 largest SCC length : "</span>, scc_len_list[:<span class="number">5</span>]</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    start_time = time.time()</div><div class="line">    file = <span class="string">"_410e934e6553ac56409b2cb7096a44aa_SCC.txt"</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"..........................................read in graph... "</span></div><div class="line">    origin_graph = readin_graph(file)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"...........................................Reverse graph... "</span></div><div class="line">    reversed_graph = reverse(origin_graph)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"...........................................1st DFS search ... "</span></div><div class="line">    magic_list = DFS(reversed_graph, nodes_to_visit=range(<span class="number">8</span>), </div><div class="line">                     reverse=<span class="keyword">True</span>, verbose=<span class="keyword">True</span>)</div><div class="line">    </div><div class="line">    magic_list.reverse()</div><div class="line">    <span class="keyword">print</span> <span class="string">"reversed magic list:"</span>, magic_list</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">".............................2nd DFS search and generage SCC.."</span></div><div class="line">    scc = DFS(origin_graph, nodes_to_visit=magic_list, </div><div class="line">              reverse=<span class="keyword">False</span>, verbose=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">"leader_with_scc:"</span>, scc</div><div class="line">    </div><div class="line">    scc_size(scc)</div></pre></td></tr></table></figure>
<p>看论坛上，有的人用递归形式的代码也跑成功了。python中，改递归上限可以使用如下代码，可能是我的机器不够强大吧。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.setrecursionlimit(<span class="number">20000</span>)</div></pre></td></tr></table></figure></p>
<p>代码可以到<a href="https://github.com/jingxiao00/Aglo_study" target="_blank" rel="external">这里</a>下载.</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p>[1] <a href="http://pikipity.github.io/blog/cousera-algorithm-week4.html" target="_blank" rel="external">http://pikipity.github.io/blog/cousera-algorithm-week4.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week4/" data-id="cis3fhhwg000fxgh5g11v4awx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algo/">Algo</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Algo Part 1 -- Programming Questions (week3)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algo/">Algo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kaggle/">kaggle</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algo/" style="font-size: 20px;">Algo</a> <a href="/tags/kaggle/" style="font-size: 10px;">kaggle</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week4/">Algo Part 1 -- Programming Questions (week4)</a>
          </li>
        
          <li>
            <a href="/2016/08/17/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week3/">Algo Part 1 -- Programming Questions (week3)</a>
          </li>
        
          <li>
            <a href="/2016/08/17/Algorithms-Design_and-Analysis-Part-1-week1-week2-summary/">Algo Part 1 -- week1 &amp; week2 summary</a>
          </li>
        
          <li>
            <a href="/2016/08/16/Algorithms-Design-and-Analysis-Part-1-Programming-Questions-week2/">Algo Part 1 -- Programming Questions (week2)</a>
          </li>
        
          <li>
            <a href="/2016/08/15/Kaggle-start/">Kaggle start</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Doreen Xinnuo Wang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>